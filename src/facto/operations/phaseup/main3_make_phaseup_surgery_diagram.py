from __future__ import annotations

import pathlib

import gen
from facto.operations.zx_lattice_graph import assert_graph_implements_permutation, ZXLatticeGraph


def main():
    out_dir = pathlib.Path(__file__).parent.parent.parent / "assets"

    g1 = ZXLatticeGraph.from_text(
        r"""
                     |ccz1>               |ccz2>                |ccz3>               |ccz4>                    @@@|ccz5>                @@@|ccz6>               @@@|ccz7>               @@@|ccz8>               @@@|ccz9>             @@@|ccz10>             @@@|ccz11>                                                                                                                                                                                           
                        |                    |                     |                    |                            |                        |                       |                       |                       |                     |                     |                                                                                                                                                                                                                                   
                        |                    |                     |                    |                            |                        |                       |                       |                       |                     |                     |                                                                                                                                                                                                                                   
                        |                    |                     |                    |                            |                        |                       |                       |                       |                     |                     |                                                                                                                                                                                                                                   
                        |  |ccz1>            |  |ccz2>             |  |ccz3>            |  |ccz4>                    |  |ccz5>                |  |ccz6>               |  |ccz7>               |  |ccz8>               |  |ccz9>             |  |ccz10>            |  |ccz11>                                                                                                                                                                                                                           
                        |   |                |   |                 |   |                |   |                        |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   |                                                                                                                                                                                                                               
                        |   |                |   |                 |   |                |   |                        |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   |                                                                                                                                                                                                                                
                        |   |                |   |                 |   |                |   |                        |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   |                                                                                                                                                                                                                                
                        |   |  |ccz1>        |   |  |ccz2>         |   |  |ccz3>        |   |  |ccz4>                |   |  |ccz5>            |   |  |ccz6>           |   |  |ccz7>           |   |  |ccz8>           |   |  |ccz9>         |   |  |ccz10>        |   |  |ccz11>                                                                                                                                                                                                                           
                        |   |   |            |   |   |             |   |   |            |   |   |                    |   |   |                |   |   |               |   |   |               |   |   |               |   |   |             |   |   |             |   |   |                                                                                                                                                                                                                                
                        |   |   |            |   |   |             |   |   |            |   |   |     X--------------Z---|---|----------------Z---|---|---------------Z---|---|---------------Z---|---|---------------Z---|---|-------------Z---|---|-------------Z   |   |                                                                                                                                                                                                                 
                        |   |   |            |   |   |             |   |   |            |   |   |      \                 |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   |                                                                                                                                                                                                                                
                        |   |   |            |   |   |             |   |   |            |   |   |       \                |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   |                                                                                                                                                                                                                                
                        |   |   |            |   |   |             |   |   |            |   |   |        \               |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   |                                                                                                                                                                                                                                
                        |   |   |            |   |   |             |   |   |            |   |   |         Z              |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   |                                                                                                                                                                                                                                 
                        |   |   |            |   |   |             |   |   |            |   |   |         |              |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   |                                                                                                                                                                                                                                 
                        |   |   |            |   |   |             |   |   |            |   |   |         |              |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   |                                                                                                                                                                                                                                 
                        |   |   |            |   |   |             |   |   |            |   |   |         |              |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   |                                                                                                                                                                                                                                 
                        |   |   |            |   |   Z---------------------Z--------------------Z         |              |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |   Z-H--------------------------@@8@cd                                                                                                                                                                                                                                 
                        |   |   |            |   |   |             |   |                |   |             |              |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                |   |             |              |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                |   |             |              |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                                                      
                        |   |   |            |   |   |             |   |                |   |             |              |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                Z-H-|-------------|----------Z---|---|--------------------|---|-------------------|---|-------------------|---|-------------------|---|-----------------|---|-----------------|------------------------abc                                                                                                                                                                                            
                        |   |   |            |   |   |             |   |                    |             |           \  |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                    |             |            \ |   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                    |             |             \|   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                    |             |              X   |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                    |             |                  |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                    |             |                  |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                    |             |                  |                    |   |                   |   |                   |   |                   |   |                 |   |                 |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                    |             |                  |                    |   |                   |   |                   |   |                   |   |                 |   Z-H------------------------------------------------@@8@bd                                                                                                                                                                                                    
                        |   |   |            |   |   |             |   |                    |             |                  |                    |   |                   |   |                   |   |                   |   |                 |                     |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |             Z-H-|--------------------|-------------|------------------|----------------Z---|---|-------------------|---|-------------------|---|-------------------|---|-----------------|---------------------|------------------------bc                                                                                                                                                                                                             
                        |   |   |            |   |   |                 |                    |             |                  |                 \  |   |                   |   |                   |   |                   |   |                 |                     |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |                 |                    |             |                  |                  \ |   |                   |   |                   |   |                   |   |                 |                     |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |                 |                    |             |                  |                   \|   |                   |   |                   |   |                   |   |                 |                     |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |                 |                    |             |                  |                    X   |                   |   |                   |   |                   |   |                 |                     |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |                 |                    |             |                  |                        |                   |   |                   |   |                   |   |                 |                     |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |                 |                    |             |                  |                        |                   |   |                   |   |                   |   |                 |                     |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |                 |                    |             |                  |                        |                   |   |                   |   |                   |   |                 |                     |                                                                                                                                                                                                                                    
                        |   |   |            |   |   |                 |                    |             |                  |                        |                   |   |                   |   |                   |   Z-H----------------------------------------------------------------------@@8@ad                                                                                                                                                                                        
                        |   |   |            |   |   |                 |                    |             |                  |                        |                   |   |                   |   |                   |                     |                     |                                                                                                                                                                                                                                    
                        |   |   |            Z-H-|---|-----------------|--------------------|-------------|------------------|------------------------|---------------Z---|---|-------------------|---|-------------------|---------------------|---------------------|------------------------ac                                                                                                                                                                                                             
                        |   |   |                |   |                 |                    |             |                  |                        |                \  |   |                   |   |                   |                     |                     |                                                                                                                                                                                                                                    
                        |   |   |                |   |                 |                    |             |                  |                        |                 \ |   |                   |   |                   |                     |                     |                                                                                                                                                                                                                                    
                        |   |   |                |   |                 |                    |             |                  |                        |                  \|   |                   |   |                   |                     |                     |                                                                                                                                                                                                                                    
                        |   |   |                |   |                 |                    |             |                  |                        |                   X   |                   |   |                   |                     |                     |                                                                                                                                                                                                                                    
                        |   |   |                |   |                 |                    |             |                  |                        |                       |                   |   |                   |                     |                     |                                                                                                                                                                                                                                    
                        |   |   |                |   |                 |                    |             |                  |                        |                       |                   |   |                   |                     |                     |                                                                                                                                                                                                                                    
                        |   |   |                |   |                 |                    |             |                  |                        |                       |                   |   |                   |                     |                     |                                                                                                                                                                                                                                    
                        |   |   |                |   |                 |                    |             |                  |                        |                       |                   |   Z-H----------------------------------------------------------------------------------------------@@8@abd                                                                                                                                                                                              
                        |   |   |                |   |                 |                    |             |                  |                        |                       |                   |                       |                     |                     |                                                                                                                                                                                                                                    
                        Z-H-|---|----------------|---|-----------------|----------------Z---|-------------|------------------|------------------------|-----------------------|---------------Z---|-----------------------|---------------------|---------------------|------------------------ab                                                                                                                                                                                                            
                            |   |                |   |                 |                 \  |             |                  |                        |                       |                \  |                       |                     |                     |                                                                                                                                                                                                                                    
                            |   |                |   |                 |                  \ |             |                  |                        |                       |                 \ |                       |                     |                     |                                                                                                                                                                                                                                    
                            |   |                |   |                 |                   \|             |                  |                        |                       |                  \|                       |                     |                     |                                                                                                                                                                                                                                    
                            |   |                |   |                 |                    X             |                  |                        |                       |                   X                       |                     |                     |                                                                                                                                                                                                                                    
                            |   |                |   |                 |                                  |                  |                        |                       |                                           |                     |                     |                                                                                                                                                                                                                                    
                            |   |                |   |                 |                                  |                  |                        |                       |                                           |                     |                     |                                                                                                                                                                                                                                    
                            |   |                |   |                 |                                  |                  |                        |                       |                                           |                     |                     |                                                                                                                                                                                                                                    
                            |   |                |   |                 |                                  |                  |                        |                       Z-H----------------------------------------------------------------------------------------------------------------------@@8@acd                                                                                                                                                                                              
                            |   |                |   |                 |                                  |                  |                        |                                                                   |                     |                     |                                                                                                                                                                                                                                    
             @@@a_in----Z---|---|------------Z---|---|-----------------|----------------------------------|------------------|------------------------|---------------------------------------------------------------Z---|---------------------|---------------------|------------------------a                                                                                                                                                                                                                          
                         \  |   |             \  |   |                 |                                  |                  |                        |                                                                \  |                     |                     |                                                                                                                                                                                                                                                                       
                          \ |   |              \ |   |                 |                                  |                  |                        |                                                                 \ |                     |                     |                                                                                                                                                                                                                                                                       
                           \|   |               \|   |                 |                                  |                  |                        |                                                                  \|                     |                     |                                                                                                                                                                                                                                                                    
                            X   |                X   |                 |                                  |                  |                        |                                                                   X                     |                     |                                                                                                                                                                                                                                                                   
                                |                    |                 |                                  |                  |                        |                                                                                         |                     |                                                                                                                                                                                                                                                                                             
                                |                    |                 |                                  |                  |                        |                                                                                         |                     |                                                                                                                                                                                                                                                                                             
                                |                    |                 |                                  |                  |                        |                                                                                         |                     |                                                                                                                                                                                                                                                                     
                                |                    |                 |                                  |                  |                        Z-H----------------------------------------------------------------------------------------------------------------------------------------------@@8@bcd                                                                                                                                                                                                                                                                                          
                                |                    |                 |                                  |                  |                                                                                                                  |                     |                                                                                                                                                                                                                                                                                             
             @@@b_in----Z-------|--------------------|-------------Z---|----------------------------------|------------------|--------------------------------------------------------------------------------------------------------------Z---|---------------------|------------------------b                                                                                                                                                                                                                        
                         \      |                    |              \  |                                  |                  |                                                                                                               \  |                     |                                                                                                                                                                                                                                                                         
                          \     |                    |               \ |                                  |                  |                                                                                                                \ |                     |                                                                                                                                                                                                                                                                         
                           \    |                    |                \|                                  |                  |                                                                                                                 \|                     |                                                                                                                                                                                                                                                                          
                            X   |                X   |                 X                                  |                  |                                                                                                                  X                     |                                                                                                                                                                                                                                                                                              
                             \  |                |\  |                                                    |                  |                                                                                                                                        |                                                                                                                                                                                                                                        
                              \ |                | \ |                                                    |                  |                                                                                                                                        |                                                                                                                                                                                                                                   
                               \|                |  \|                                                    |                  |                                                                                                                                        |                                                                                                                                                                                                                                
                                X                |   X                                                    |                  Z-H--------------------------------------------------------------------------------------------------------------------------------------|--------------------------------@@8@abcd                                                                                                                                                                                                                                                                
                                                 |                                                        |                                                                                                                                                           |                                                                                                                                                                                                                                                                                             
             @@@c_in-------------------------Z---|--------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------Z---|------------------------c                                                                                                                                                                                                                        
                                              \  |                                                        |                                                                                                                                                        \  |                                                                                                                                                                                                                                                                                                           
                                               \ |                                                        |                                                                                                                                                         \ |                                                                                                                                                                                                                                                                                                           
                                                \|                                                        |                                                                                                                                                          \|                                                                                                                                                                                                                                                                                                           
                                                 X                                                        X--------------Z                                                                                                                                            X                                                                                                                                                                                                                                                                                                                        
                                                                                                                          \                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                           \                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                            \                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                        d_in-------------------------------------------------------------------------------------------------Z-------------------------------------------------------------------------------------------------------------------------------------------------------------------------d                                                                                                                                                                                                                        
                                                
        """
    )

    def func(kv: dict[str, int]) -> dict[str, int]:
        a = kv["a_in"]
        b = kv["b_in"]
        c = kv["c_in"]
        d = kv["d_in"]
        return {
            "a": a,
            "b": b,
            "ab": a & b,
            "c": c,
            "ac": a & c,
            "bc": b & c,
            "abc": a & b & c,
            "d": d,
            "bcd": b & c & d,
            "abcd": a & b & c & d,
            "acd": a & c & d,
            "ad": a & d,
            "abd": a & b & d,
            "bd": b & d,
            "cd": c & d,
        }

    assert_graph_implements_permutation(g1, func)
    gen.viz_3d_gltf_model_html(g1.to_3d_model(wireframe=True)).write_to(
        out_dir / "phase_lookup_wireframe.html"
    )
    gen.viz_3d_gltf_model_html(g1.to_3d_model()).write_to(out_dir / "phase_lookup.html")


if __name__ == "__main__":
    main()
